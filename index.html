<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Eliana’s WA Driver's Practice – GP Build</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    .img-shadow{box-shadow:0 10px 25px rgba(0,0,0,.15)}
  </style>
</head>
<body class="bg-pink-50">
  <div id="app"></div>
  <script src="https://unpkg.com/preact@10.24.3/dist/preact.umd.js"></script>
  <script src="https://unpkg.com/preact@10.24.3/hooks/dist/hooks.umd.js"></script>
  <script src="https://unpkg.com/htm@3.1.1/dist/htm.umd.js"></script>
  <script>
    const {h, render} = preact;
    const {useState, useMemo, useEffect} = preactHooks;
    const html = htm.bind(h);
    const YES_COUNT = 78, NO_COUNT = 47;
    const YES_FOLDER = "yes", NO_FOLDER = "no";
    const yesUrl = n => `./${YES_FOLDER}/Yes_${n}.jpg`;
    const noUrl  = n => `./${NO_FOLDER}/No_${n}.jpg`;
    const randInt=(min,max)=>Math.floor(Math.random()*(max-min+1))+min;
    const QUESTION_BANK = [
      { id:"sign-1", category:"Road Signs", question:"What does a flashing yellow light mean?",
        choices:["Stop completely, then proceed when clear","Proceed with caution; slow down and be prepared to yield","It’s a protected left-turn signal","Traffic signal is about to turn red; stop immediately"],
        correctIndex:1, explanation:"Proceed with caution and be ready to yield."},
      { id:"sign-2", category:"Road Signs", question:"A pentagon-shaped sign indicates:",
        choices:["Railroad crossing","School zone or school crossing","No passing zone","Work zone"], correctIndex:1, explanation:"Pentagon = school zone/crossing."},
      { id:"rules-1", category:"Rules of the Road", question:"You reach a four-way stop at the same time as a car on your right. Who goes first?",
        choices:["You do","They do","Whoever is going straight","Largest vehicle"], correctIndex:1, explanation:"Vehicle on the right has right-of-way."},
      { id:"rules-2", category:"Rules of the Road", question:"When must you use headlights in WA?",
        choices:["Only when it's raining","30 min after sunset to 30 min before sunrise, and when visibility is reduced","Only on rural roads","Only on highways"],
        correctIndex:1, explanation:"Use headlights during those times or when visibility is reduced."},
      { id:"veh-1", category:"Vehicles", question:"When parking downhill with a curb, turn your wheels:",
        choices:["Toward the curb","Away from the curb","Straight","Doesn't matter"],
        correctIndex:0, explanation:"Turn toward the curb so the car rolls into it if brakes fail."},
      { id:"veh-2", category:"Vehicles", question:"ABS helps you during emergency braking by:",
        choices:["Shortening stopping distance","Letting you steer while braking","Turning on hazard lights","Locking the wheels for grip"],
        correctIndex:1, explanation:"ABS allows steering while braking hard."},
      { id:"risk-1", category:"Risks", question:"Hydroplaning: what should you do first?",
        choices:["Brake hard","Ease off the accelerator and steer straight","Turn sharply","Shift to neutral and turn off ignition"],
        correctIndex:1, explanation:"Ease off gas and keep wheels straight."},
      { id:"risk-2", category:"Risks", question:"The three‑second rule helps you set:",
        choices:["Stopping distance","Following distance","Reaction time","Blind spot size"],
        correctIndex:1, explanation:"Use it to maintain safe following distance."},
      { id:"safe-1", category:"Safety", question:"Before changing lanes, best practice is to:",
        choices:["Signal only","Signal, check mirrors, and look over your shoulder","Honk and go","Speed up without signaling"],
        correctIndex:1, explanation:"Signal + mirrors + quick shoulder check."},
    ];
    const KEY_ATTEMPTS="eliana_attempts_v2";
    const readAttempts=()=>{try{const r=localStorage.getItem(KEY_ATTEMPTS);return r?JSON.parse(r):[]}catch(e){return[];}};
    const writeAttempts=(a)=>localStorage.setItem(KEY_ATTEMPTS, JSON.stringify(a));
    const bestScoresByCategory=(attempts)=>{
      const best={}; for(const a of attempts){const k=a.category||"All"; if(!best[k]||a.percent>best[k].percent) best[k]=a;} return best;
    };
    const shuffle=(arr)=>{arr=[...arr]; for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr;};
    function Nav({go}){
      return html`<div class="sticky top-0 z-10 bg-pink-100/90 backdrop-blur border-b border-pink-200">
        <div class="mx-auto max-w-4xl px-4 py-3 flex items-center gap-2">
          <button class="rounded-xl bg-black text-white px-3 py-1.5 hover:bg-pink-600" onClick=${()=>go('home')}>Home</button>
          <div class="hidden md:flex gap-2">
            <button class="rounded-xl border border-pink-400 px-3 py-1.5" onClick=${()=>go('quiz')}>Quiz</button>
            <button class="rounded-xl border border-pink-400 px-3 py-1.5" onClick=${()=>go('tips')}>Hints & Tips</button>
            <button class="rounded-xl border border-pink-400 px-3 py-1.5" onClick=${()=>go('rules')}>Rules</button>
            <button class="rounded-xl border border-pink-400 px-3 py-1.5" onClick=${()=>go('vehicles')}>Vehicles</button>
            <button class="rounded-xl border border-pink-400 px-3 py-1.5" onClick=${()=>go('risks')}>Risks</button>
            <button class="rounded-xl border border-pink-400 px-3 py-1.5" onClick=${()=>go('vocab')}>Vocab</button>
            <button class="rounded-xl border border-pink-400 px-3 py-1.5" onClick=${()=>go('scores')}>Top Scores</button>
          </div>
        </div>
      </div>`;
    }
    function Card({title,desc,onClick}){
      return html`<button onClick=${onClick} class="rounded-2xl bg-white p-5 text-left shadow border border-pink-200 hover:border-black transition">
        <div class="text-lg font-semibold text-black">${title}</div>
        <div class="mt-1 text-sm text-neutral-700">${desc}</div>
      </button>`;
    }
    function Home({go}){
      return html`<div class="space-y-6">
        <header class="flex items-center justify-between">
          <h1 class="text-2xl md:text-3xl font-bold text-black">Eliana’s WA Driver’s Practice</h1>
          <span class="text-sm text-pink-600">Beat your best, learn fast.</span>
        </header>
        <div class="grid sm:grid-cols-2 gap-4">
          ${Card({title:"Take a Quiz", desc:"Smart practice across topics.", onClick:()=>go('quiz')})}
          ${Card({title:"Top Scores", desc:"Can you beat your best today?", onClick:()=>go('scores')})}
          ${Card({title:"Hints & Tips", desc:"Memory boosters and strategies.", onClick:()=>go('tips')})}
          ${Card({title:"Rules of the Road", desc:"Signals, intersections, parking.", onClick:()=>go('rules')})}
          ${Card({title:"Vehicles", desc:"Controls, maintenance, safety tech.", onClick:()=>go('vehicles')})}
          ${Card({title:"Risks", desc:"Speed, space, time, conditions.", onClick:()=>go('risks')})}
          ${Card({title:"Vocab", desc:"Glossary flashcards.", onClick:()=>go('vocab')})}
        </div>
      </div>`;
    }
    function QuestionCard({index,total,q,chosen,onChoose,onNext,onPrev,instantFeedback,order,feedbackImg}){
      const answered = chosen!==undefined && chosen!==null;
      const ok = answered && chosen===q.correctIndex;
      return html`<div class="rounded-2xl bg-white p-5 shadow border border-pink-200">
        <div class="mb-4 flex items-center justify-between">
          <span class="text-sm text-neutral-500">Question ${index+1} of ${total}</span>
          <span class="text-sm font-medium text-pink-600">${q.category}</span>
        </div>
        <h2 class="mb-4 text-xl font-semibold text-black">${q.question}</h2>
        <div class="space-y-3">
          ${order.map((choiceIdx,i)=>{
            const isSelected = chosen===choiceIdx;
            const showC = instantFeedback && answered && choiceIdx===q.correctIndex;
            const showW = instantFeedback && isSelected && !ok;
            const cls = ["w-full rounded-xl border p-3 text-left transition",
              isSelected?"border-black bg-pink-50":"border-neutral-200",
              showC?"bg-green-50 border-green-400":"",
              showW?"bg-red-50 border-red-400":""].join(" ");
            return html`<button key=${i} class=${cls} onClick=${()=>onChoose(choiceIdx)}>
              <span class="mr-2 font-mono text-sm text-neutral-500">${i+1}.</span> ${q.choices[choiceIdx]}
            </button>`;
          })}
        </div>
        ${instantFeedback && answered ? html`<div class=${"mt-4 rounded-xl p-3 "+(ok?"bg-green-50":"bg-orange-50")}>
          <p class="text-sm">${ok?"Correct!":"Not quite."} ${q.explanation? q.explanation: ""}</p>
        </div>`: ""}
        ${answered && feedbackImg ? html`<div class="mt-4 flex justify-center">
          <img src=${feedbackImg.src} alt=${feedbackImg.alt} class="max-h-72 rounded-xl img-shadow object-contain" onError=${e=>{e.currentTarget.style.display='none';}}/>
        </div>`: ""}
        <div class="mt-6 flex items-center justify-between">
          <button onClick=${onPrev} disabled=${index===0} class="rounded-xl border px-4 py-2 border-pink-400 disabled:opacity-40">Back</button>
          <button onClick=${onNext} class="rounded-2xl bg-black px-5 py-2 text-white hover:bg-pink-600">${index===total-1?"Finish":"Next"}</button>
        </div>
      </div>`;
    }
    function ScoresPage(){
      const [attempts, setAttempts] = useState(readAttempts());
      useEffect(()=>{
        const h = ()=>setAttempts(readAttempts());
        window.addEventListener('storage', h);
        return ()=>window.removeEventListener('storage', h);
      }, []);
      const best = bestScoresByCategory(attempts);
      const cats = Object.keys(best);
      return html`<div class="space-y-6">
        <div class="rounded-2xl bg-white p-5 shadow border border-pink-300">
          <h2 class="text-xl font-semibold text-black">Top Scores</h2>
          ${cats.length===0 ? html`<p class="text-sm mt-2 text-neutral-700">No attempts yet. Take a quiz!</p>`
           : html`<div class="mt-4 grid sm:grid-cols-2 gap-3">
              ${cats.map(cat=>{
                const b=best[cat];
                return html`<div class="rounded-xl border p-3">
                  <div class="text-sm text-neutral-500">${cat}</div>
                  <div class="text-lg font-semibold text-black">${b.percent}% <span class="text-sm text-neutral-600">(${b.score}/${b.total})</span></div>
                  <div class="text-xs text-neutral-500">on ${new Date(b.date).toLocaleString()}</div>
                </div>`;
              })}
            </div>`}
        </div>
        <div class="rounded-2xl bg-white p-5 shadow border border-pink-200">
          <h3 class="text-lg font-semibold text-black">All Attempts</h3>
          ${attempts.length===0 ? html`<p class="text-sm mt-2 text-neutral-700">No attempts yet.</p>`
           : html`<div class="overflow-x-auto mt-3">
              <table class="w-full text-sm">
                <thead><tr class="text-left"><th class="py-1 pr-2">When</th><th class="py-1 pr-2">Category</th><th class="py-1 pr-2">Score</th><th class="py-1 pr-2">%</th></tr></thead>
                <tbody>
                  ${attempts.slice().reverse().map((a,i)=> html`<tr class="border-t">
                    <td class="py-1 pr-2">${new Date(a.date).toLocaleString()}</td>
                    <td class="py-1 pr-2">${a.category}</td>
                    <td class="py-1 pr-2">${a.score}/${a.total}</td>
                    <td class="py-1 pr-2">${a.percent}%</td>
                  </tr>`)}
                </tbody>
              </table>
            </div>`}
            ${attempts.length>0 ? html`<button onClick=${()=>{ if(confirm("Clear all saved scores?")){ localStorage.removeItem(KEY_ATTEMPTS); setAttempts([]); } }} class="mt-3 rounded-xl border border-pink-400 px-3 py-1.5">Clear all</button>`:""}
        </div>
      </div>`;
    }
    function TipsPage(){
      return html`<div class="rounded-2xl bg-white p-5 shadow border border-pink-300">
        <h2 class="text-xl font-semibold text-black">Hints & Tips</h2>
        <ul class="list-disc pl-6 mt-2 text-sm text-neutral-700 space-y-1">
          <li>Do 10–15 questions at a time; short breaks help memory.</li>
          <li>Say answers out loud; teach back to a parent for bonus points.</li>
          <li>Use the Yes/No images as “streaks.” Aim for a 5‑in‑a‑row streak!</li>
          <li>When unsure, eliminate 2 choices first, then pick between the final 2.</li>
          <li>On the road, call out signs and their meanings while riding as a passenger.</li>
        </ul>
      </div>`;
    }
    function RulesPage(){ return html`<div class="space-y-3">
      ${SectionCard({title:"Traffic signals & signs", desc:"Concise summaries + quick quizzes."})}
      ${SectionCard({title:"Intersections, turns & roundabouts", desc:"Right‑of‑way, U‑turns, diverging diamonds."})}
      ${SectionCard({title:"Parking & hills", desc:"Where/when you can park; hills with/without curbs."})}
      ${SectionCard({title:"School / work / emergency zones", desc:"Speeds, fines, and safe passing rules."})}
    </div>`; }
    function VehiclesPage(){ return html`<div class="space-y-3">
      ${SectionCard({title:"Know your vehicle", desc:"Controls, reference points, mirrors, blind zones."})}
      ${SectionCard({title:"Safety tech (ADAS)", desc:"ABS, lane keeping, blind‑spot monitoring—assist, not replace!"})}
      ${SectionCard({title:"Maintenance", desc:"Tires (2/32\"), lights, signals, wipers, fluids."})}
      ${SectionCard({title:"Occupant protection", desc:"Seat belts, airbags, child seats."})}
    </div>`; }
    function RisksPage(){ return html`<div class="space-y-3">
      ${SectionCard({title:"Speed / Space / Time", desc:"Following distance, merging, counting seconds."})}
      ${SectionCard({title:"Conditions", desc:"Night, rain, fog, curves, hydroplaning & skids."})}
      ${SectionCard({title:"Impairment & distraction", desc:"Alcohol, cannabis, meds, fatigue, phones."})}
      ${SectionCard({title:"Breakdowns & crashes", desc:"Communicating risks, reporting collisions."})}
    </div>`; }
    function VocabPage(){ return html`<div class="rounded-2xl bg-white p-5 shadow border border-pink-300">
      <h2 class="text-xl font-semibold text-black">Glossary Flashcards</h2>
      <p class="text-sm text-neutral-700 mt-2">Coming next: auto‑filled from the WA DOL PDF you uploaded.</p>
    </div>`; }
    function SectionCard({title,desc}){
      return html`<div class="rounded-2xl bg-white p-5 shadow border border-pink-200">
        <div class="text-lg font-semibold text-black">${title}</div>
        <div class="text-sm text-neutral-700 mt-1">${desc}</div>
      </div>`;
    }
    function QuizPage({go}){
      const [started,setStarted]=useState(false);
      const [category,setCategory]=useState("All");
      const [count,setCount]=useState(10);
      const [instantFeedback,setInstantFeedback]=useState(true);
      const [current,setCurrent]=useState(0);
      const [answers,setAnswers]=useState({});
      const [showResults,setShowResults]=useState(false);
      const [answerOrderSeed,setAnswerOrderSeed]=useState(0);
      const [feedbackImg,setFeedbackImg]=useState(null);
      const categories = useMemo(()=>["All", ...Array.from(new Set(QUESTION_BANK.map(q=>q.category)))], []);
      const filtered = useMemo(()=>{
        const pool = category==="All" ? QUESTION_BANK : QUESTION_BANK.filter(q=>q.category===category);
        return shuffle(pool).slice(0, Math.min(count, pool.length));
      }, [category, count, started]);
      const answerOrderMap = useMemo(()=>{
        const map={}; filtered.forEach(q=> map[q.id]=shuffle(q.choices.map((_,i)=>i))); return map;
      }, [filtered, answerOrderSeed]);
      const currentQ = filtered[current];
      function selectAnswer(choiceIndex){
        setAnswers(prev=>({...prev,[currentQ.id]:choiceIndex}));
        const ok = choiceIndex===currentQ.correctIndex;
        setFeedbackImg(ok ? {src: yesUrl(randInt(1,YES_COUNT)), alt:"Yes!"}
                          : {src:  noUrl(randInt(1,NO_COUNT)), alt:"Try again"});
      }
      function next(){ if(current<filtered.length-1){ setCurrent(c=>c+1); setFeedbackImg(null);} else setShowResults(true); }
      function prev(){ if(current>0){ setCurrent(c=>c-1); setFeedbackImg(null);} }
      const score = filtered.reduce((s,q)=> s + ((answers[q.id]===q.correctIndex)?1:0), 0);
      const percent = filtered.length ? Math.round((score/filtered.length)*100) : 0;
      function restart(){ setStarted(false); setCurrent(0); setAnswers({}); setShowResults(false); setAnswerOrderSeed(x=>x+1); setFeedbackImg(null); }
      useEffect(()=>{
        if(showResults){
          const a = readAttempts();
          a.push({ date:new Date().toISOString(), category, score, total:filtered.length, percent });
          writeAttempts(a);
        }
      }, [showResults]);
      return html`<div class="space-y-6">
        ${!started ? html`<div class="rounded-2xl bg-white p-5 shadow border border-pink-300">
          <h2 class="mb-4 text-xl font-semibold text-black">Quiz Settings</h2>
          <div class="grid gap-4 md:grid-cols-3">
            <div class="flex flex-col gap-2">
              <label class="text-sm text-pink-700">Category</label>
              <select class="rounded-xl border border-pink-400 p-2" value=${category} onChange=${e=>setCategory(e.target.value)}>
                ${categories.map(c=> html`<option value=${c}>${c}</option>`)}
              </select>
            </div>
            <div class="flex flex-col gap-2">
              <label class="text-sm text-pink-700"># of Questions</label>
              <input class="rounded-xl border border-pink-400 p-2" type="number" min="5" max="20" value=${count} onInput=${e=>setCount(Number(e.target.value))}/>
            </div>
            <div class="flex items-center gap-3">
              <input id="instant" type="checkbox" class="h-5 w-5 text-pink-600" checked=${instantFeedback} onChange=${e=>setInstantFeedback(e.target.checked)}/>
              <label for="instant" class="text-sm text-black">Instant feedback</label>
            </div>
          </div>
          <div class="mt-6 flex gap-3">
            <button onClick=${()=>setStarted(true)} class="rounded-2xl bg-black px-5 py-3 text-white hover:bg-pink-600">Start</button>
            <button onClick=${()=>go('scores')} class="rounded-2xl border border-pink-400 px-5 py-3">See Top Scores</button>
          </div>
        </div>`
        : !showResults ? html`${QuestionCard({
            index: current, total: filtered.length, q: currentQ,
            chosen: (answers[currentQ?.id] ?? null), onChoose: selectAnswer, onNext: next, onPrev: prev,
            instantFeedback, order: answerOrderMap[currentQ?.id] || [], feedbackImg
          })}`
        : html`<div class="rounded-2xl bg-white p-6 shadow border border-pink-300">
            <h2 class="text-xl font-semibold text-black">Great work, Eliana!</h2>
            <p class="mt-2 text-neutral-700">Score: <b>${score}</b> / ${filtered.length} (${percent}%)</p>
            <div class="mt-4 flex gap-2">
              <button onClick=${restart} class="rounded-2xl bg-black px-5 py-2 text-white hover:bg-pink-600">Try Again</button>
              <button onClick=${()=>go('scores')} class="rounded-2xl border border-pink-400 px-5 py-2">View Top Scores</button>
              <button onClick=${()=>go('home')} class="rounded-2xl border border-pink-400 px-5 py-2">Home</button>
            </div>
          </div>`}
      </div>`;
    }
    function App(){
      const [route, setRoute] = useState('home');
      const go = (r)=>{ setRoute(r); window.scrollTo(0,0); };
      return html`<div class="min-h-screen">
        ${Nav({go})}
        <main class="mx-auto max-w-4xl px-4 py-6">
          ${route==='home' ? Home({go})
           : route==='quiz' ? QuizPage({go})
           : route==='tips' ? TipsPage()
           : route==='rules' ? RulesPage()
           : route==='vehicles' ? VehiclesPage()
           : route==='risks' ? RisksPage()
           : route==='vocab' ? VocabPage()
           : route==='scores' ? ScoresPage()
           : Home({go})}
        </main>
      </div>`;
    }
    render(h(App, {}), document.getElementById('app'));
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eliana's WA Driving Study App üöóüíï</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff69b4, #ffb6c1, #000000);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #ff1493;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #ff1493;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
        }

        .main-menu {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .menu-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            border: 3px solid transparent;
        }

        .menu-card:hover {
            transform: translateY(-5px);
            border-color: #ff1493;
            box-shadow: 0 8px 32px rgba(255, 20, 147, 0.2);
        }

        .menu-card h3 {
            color: #ff1493;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .menu-card p {
            color: #666;
            font-size: 0.9em;
        }

        .question-area {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .question {
            font-size: 1.2em;
            margin-bottom: 20px;
            color: #333;
            line-height: 1.6;
        }

        .answers {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }

        .answer-btn {
            background: linear-gradient(135deg, #ffb6c1, #ff69b4);
            border: none;
            padding: 15px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1em;
            color: white;
            transition: all 0.3s ease;
            text-align: left;
        }

        .answer-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(255, 105, 180, 0.3);
        }

        .answer-btn.correct {
            background: linear-gradient(135deg, #98fb98, #32cd32);
        }

        .answer-btn.incorrect {
            background: linear-gradient(135deg, #ffa0a0, #ff6b6b);
        }

        .explanation {
            background: rgba(255, 182, 193, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid #ff1493;
            display: none;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #ff1493, #ff69b4);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(255, 20, 147, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .category-selector {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .category-btn {
            background: linear-gradient(135deg, #ffb6c1, #ff69b4);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .category-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(255, 105, 180, 0.3);
        }

        .reward-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .reward-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            animation: bounceIn 0.5s ease;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        .reward-image {
            max-width: 200px;
            max-height: 200px;
            border-radius: 15px;
            margin: 15px 0;
        }

        .progress-bar {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            height: 10px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(135deg, #ff1493, #ff69b4);
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .celebration {
            font-size: 2em;
            margin: 10px 0;
        }

        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .stats-bar {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöó Eliana's Driving Study App üíï</h1>
            <p>Master the WA State Driving Test with Style!</p>
        </div>

        <div class="stats-bar">
            <div class="stat">
                <div class="stat-value" id="totalQuestions">0</div>
                <div class="stat-label">Questions Answered</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="correctAnswers">0</div>
                <div class="stat-label">Correct</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="currentStreak">0</div>
                <div class="stat-label">Current Streak</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="bestStreak">0</div>
                <div class="stat-label">Best Streak</div>
            </div>
        </div>

        <div class="main-menu" id="mainMenu">
            <div class="menu-card" onclick="startPractice()">
                <h3>üéØ Practice Mode</h3>
                <p>Study at your own pace with instant feedback and explanations</p>
            </div>
            <div class="menu-card" onclick="showCategorySelector()">
                <h3>üìö Study by Category</h3>
                <p>Focus on specific topics like signs, parking, or safety</p>
            </div>
            <div class="menu-card" onclick="startMockTest()">
                <h3>üìù Mock DMV Test</h3>
                <p>Take a practice test just like the real thing!</p>
            </div>
            <div class="menu-card" onclick="showStats()">
                <h3>üìä My Progress</h3>
                <p>See your improvement and celebrate your achievements</p>
            </div>
        </div>

        <div class="category-selector" id="categorySelector">
            <h2 style="text-align: center; color: #ff1493; margin-bottom: 15px;">Choose Your Study Topic üìñ</h2>
            <div class="category-grid">
                <button class="category-btn" onclick="startCategoryPractice('signs')">üö¶ Signs & Signals</button>
                <button class="category-btn" onclick="startCategoryPractice('parking')">üÖøÔ∏è Parking Rules</button>
                <button class="category-btn" onclick="startCategoryPractice('safety')">üõ°Ô∏è Safety & Risks</button>
                <button class="category-btn" onclick="startCategoryPractice('vehicles')">üöó Vehicle Knowledge</button>
                <button class="category-btn" onclick="startCategoryPractice('laws')">‚öñÔ∏è Traffic Laws</button>
                <button class="category-btn" onclick="startCategoryPractice('technology')">üíª Vehicle Technology</button>
            </div>
            <button class="btn" onclick="showMainMenu()" style="margin-top: 20px;">‚Üê Back to Main Menu</button>
        </div>

        <div class="question-area" id="questionArea">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="question" id="questionText"></div>
            <div class="answers" id="answersContainer"></div>
            <div class="explanation" id="explanation"></div>
            <div class="controls">
                <button class="btn" onclick="showMainMenu()">üè† Home</button>
                <div>
                    <span id="questionCounter">1 / 10</span>
                </div>
                <button class="btn" id="nextBtn" onclick="nextQuestion()" disabled>Next Question ‚û°Ô∏è</button>
            </div>
        </div>
    </div>

    <div class="reward-modal" id="rewardModal">
        <div class="reward-content">
            <div class="celebration" id="celebrationText">üéâ</div>
            <h2 id="rewardTitle">Great Job!</h2>
            <img class="reward-image" id="rewardImage" src="" alt="Reward">
            <p id="rewardMessage"></p>
            <button class="btn" onclick="closeReward()">Continue üí™</button>
        </div>
    </div>

    <script>
        // App State
        let currentQuestion = 0;
        let questions = [];
        let currentMode = '';
        // Enhanced stats tracking for parent visibility
        let stats = {
            totalQuestions: 0,
            correctAnswers: 0,
            currentStreak: 0,
            bestStreak: 0,
            categoryStats: {},
            studySessions: [],
            totalStudyTime: 0,
            lastStudyDate: null,
            dailyGoalStreak: 0
        };

        // Track study session
        function trackStudySession() {
            const now = new Date();
            const sessionData = {
                date: now.toISOString().split('T')[0], // YYYY-MM-DD format
                time: now.toLocaleTimeString(),
                mode: currentMode,
                questionsAnswered: 0,
                correctAnswers: 0,
                timeSpent: 0,
                sessionStart: now
            };
            
            // Add to current session
            stats.currentSession = sessionData;
        }

        // End study session
        function endStudySession() {
            if (stats.currentSession) {
                const endTime = new Date();
                const timeSpent = Math.round((endTime - stats.currentSession.sessionStart) / 1000 / 60); // minutes
                
                stats.currentSession.timeSpent = timeSpent;
                stats.totalStudyTime += timeSpent;
                stats.lastStudyDate = stats.currentSession.date;
                
                // Add to sessions history
                if (!stats.studySessions) stats.studySessions = [];
                stats.studySessions.push({
                    date: stats.currentSession.date,
                    time: stats.currentSession.time,
                    mode: stats.currentSession.mode,
                    questionsAnswered: stats.currentSession.questionsAnswered,
                    correctAnswers: stats.currentSession.correctAnswers,
                    timeSpent: stats.currentSession.timeSpent,
                    accuracy: stats.currentSession.questionsAnswered > 0 ? 
                        Math.round((stats.currentSession.correctAnswers / stats.currentSession.questionsAnswered) * 100) : 0
                });
                
                // Keep only last 30 sessions to manage storage
                if (stats.studySessions.length > 30) {
                    stats.studySessions = stats.studySessions.slice(-30);
                }
                
                delete stats.currentSession;
                saveStats();
                
                // Send usage data to parent dashboard
                sendUsageData();
            }
        }

        // Google Sheets configuration
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx6v9i1RjgOzURjwhQ1ibjcESokhlZijpt3oPYWd3Yoaj2t5b5gPiGPzw6_gG9HvLBSeA/exec';
        
        // Send usage data to Google Sheets using CORS-free method
        function sendUsageData() {
            // Create a summary for easy parent viewing
            const today = new Date().toISOString().split('T')[0];
            const todaySessions = stats.studySessions.filter(s => s.date === today);
            const thisWeekSessions = stats.studySessions.filter(s => {
                const sessionDate = new Date(s.date);
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                return sessionDate >= weekAgo;
            });
            
            const summary = {
                lastStudied: stats.lastStudyDate,
                totalQuestions: stats.totalQuestions,
                accuracy: stats.totalQuestions > 0 ? Math.round((stats.correctAnswers / stats.totalQuestions) * 100) : 0,
                bestStreak: stats.bestStreak,
                totalStudyTime: stats.totalStudyTime,
                todayStudyTime: todaySessions.reduce((total, s) => total + s.timeSpent, 0),
                weeklyStudyTime: thisWeekSessions.reduce((total, s) => total + s.timeSpent, 0),
                sessionsToday: todaySessions.length,
                sessionsThisWeek: thisWeekSessions.length
            };
            
            // Store summary in localStorage with a special key for parent access
            localStorage.setItem('elianaStudyReport', JSON.stringify({
                lastUpdated: new Date().toISOString(),
                summary: summary,
                recentSessions: stats.studySessions.slice(-5) // Last 5 sessions
            }));
            
            // Send to Google Sheets using CORS-free method (hidden form submission)
            if (stats.currentSession) {
                const sessionData = {
                    date: stats.currentSession.date,
                    time: stats.currentSession.time,
                    studyMode: stats.currentSession.mode,
                    questionsAnswered: stats.currentSession.questionsAnswered,
                    correctAnswers: stats.currentSession.correctAnswers,
                    accuracy: stats.currentSession.questionsAnswered > 0 ? 
                        Math.round((stats.currentSession.correctAnswers / stats.currentSession.questionsAnswered) * 100) : 0,
                    timeSpent: stats.currentSession.timeSpent,
                    bestStreak: stats.bestStreak,
                    totalQuestions: stats.totalQuestions,
                    overallAccuracy: stats.totalQuestions > 0 ? Math.round((stats.correctAnswers / stats.totalQuestions) * 100) : 0
                };
                
                // Send to Google Sheets using CORS-free method (image pixel technique)
                const params = new URLSearchParams();
                Object.keys(sessionData).forEach(key => {
                    params.append(key, sessionData[key]);
                });
                
                // Use image pixel method - no CSP issues
                const img = new Image();
                img.onload = () => console.log('üìä Study data sent to parent dashboard successfully!');
                img.onerror = () => console.log('üìä Study data sent (response blocked by browser, but data saved)');
                img.src = 'https://script.google.com/macros/s/AKfycby1PYo-9W28H2daLEDeeq7FNig9VfCWLASm8fFOm2DGJx2aUaCAHIyYhTbhbt8_h3tvuA/exec?' + params.toString();
                
                // Fallback: Also store locally
                console.log('üìä Study session data logged locally and sent to Google Sheets');
            }
        }

        // Expanded question bank with more comprehensive questions
        const questionBank = {
            signs: [
                {
                    question: "What does a red octagonal sign mean?",
                    answers: ["Yield to other traffic", "Stop completely", "Slow down", "No parking"],
                    correct: 1,
                    explanation: "A red octagonal sign is a STOP sign. You must come to a complete stop and yield to traffic and pedestrians before proceeding.",
                    category: "signs"
                },
                {
                    question: "What does a yellow diamond-shaped sign typically warn about?",
                    answers: ["Speed limit changes", "General road hazards ahead", "Construction zones only", "School zones only"],
                    correct: 1,
                    explanation: "Yellow diamond-shaped signs warn drivers about general road conditions and hazards ahead, such as curves, hills, or other dangers.",
                    category: "signs"
                },
                {
                    question: "What color are construction and maintenance warning signs?",
                    answers: ["Yellow", "Orange", "Red", "Blue"],
                    correct: 1,
                    explanation: "Orange signs warn of construction and maintenance work zones where workers may be present.",
                    category: "signs"
                },
                {
                    question: "What does a triangular red and white sign mean?",
                    answers: ["Stop", "Yield", "No entry", "One way"],
                    correct: 1,
                    explanation: "A triangular red and white sign is a YIELD sign, meaning you must slow down and give the right-of-way to other traffic.",
                    category: "signs"
                },
                {
                    question: "What color are regulatory signs?",
                    answers: ["Yellow", "Orange", "White", "Green"],
                    correct: 2,
                    explanation: "White signs provide regulatory information, such as speed limits, parking rules, and traffic directions.",
                    category: "signs"
                },
                {
                    question: "What do brown signs typically indicate?",
                    answers: ["Construction zones", "Public recreation areas", "Emergency services", "Speed limits"],
                    correct: 1,
                    explanation: "Brown signs indicate public recreation, cultural, and historical area identification.",
                    category: "signs"
                },
                {
                    question: "What should you do when you see a 'Wrong Way' sign?",
                    answers: ["Continue carefully", "Slow down", "Stop and turn around immediately", "Call police"],
                    correct: 2,
                    explanation: "A 'Wrong Way' sign means you're driving in the wrong direction and must stop and turn around immediately to prevent head-on collisions.",
                    category: "signs"
                },
                {
                    question: "What color are guide or directional signs?",
                    answers: ["Blue", "Green", "Brown", "White"],
                    correct: 1,
                    explanation: "Green signs provide guide or directional information, such as distances to cities and highway exits.",
                    category: "signs"
                }
            ],
            parking: [
                {
                    question: "How far must you park from a fire hydrant?",
                    answers: ["5 feet", "10 feet", "15 feet", "20 feet"],
                    correct: 2,
                    explanation: "You must park at least 15 feet away from a fire hydrant to ensure emergency vehicles can access it quickly.",
                    category: "parking"
                },
                {
                    question: "When parking on a hill facing downward, which way should you turn your wheels?",
                    answers: ["Away from the curb", "Toward the curb", "Straight ahead", "It doesn't matter"],
                    correct: 1,
                    explanation: "When parking downhill, turn your wheels toward the curb so if your car rolls, it will roll into the curb rather than into traffic.",
                    category: "parking"
                },
                {
                    question: "When parking uphill with a curb, which way should you turn your wheels?",
                    answers: ["Toward the curb", "Away from the curb", "Straight ahead", "Either direction"],
                    correct: 1,
                    explanation: "When parking uphill with a curb, turn wheels away from the curb so the back of the tire touches the curb if the car rolls backward.",
                    category: "parking"
                },
                {
                    question: "How far from the curb can you legally park?",
                    answers: ["6 inches", "12 inches", "18 inches", "24 inches"],
                    correct: 1,
                    explanation: "You must park no more than 12 inches from the curb to avoid blocking traffic lanes.",
                    category: "parking"
                },
                {
                    question: "Should you always set your parking brake?",
                    answers: ["Only on hills", "Only in winter", "Yes, always", "Only with manual transmission"],
                    correct: 2,
                    explanation: "Always set your parking brake, especially on hills, to prevent your vehicle from rolling.",
                    category: "parking"
                },
                {
                    question: "How far must you park from a stop sign?",
                    answers: ["15 feet", "20 feet", "30 feet", "50 feet"],
                    correct: 2,
                    explanation: "You must park at least 30 feet away from a stop sign to ensure other drivers can see the sign clearly.",
                    category: "parking"
                },
                {
                    question: "What is the 'Dutch Reach' method?",
                    answers: ["A parking technique", "Opening car door with far hand to check for cyclists", "A turn signal method", "A backing technique"],
                    correct: 1,
                    explanation: "The Dutch Reach involves opening your door with the hand farthest from the door, forcing you to turn and see approaching cyclists.",
                    category: "parking"
                },
                {
                    question: "What does a white curb typically indicate?",
                    answers: ["No parking", "Short-term parking only", "Loading zone", "Fire lane"],
                    correct: 1,
                    explanation: "White curbs typically indicate that only short stops are permitted, such as for passenger loading.",
                    category: "parking"
                }
            ],
            safety: [
                {
                    question: "What is the recommended following distance in good weather conditions?",
                    answers: ["1 second", "2 seconds", "3-4 seconds", "5-6 seconds"],
                    correct: 2,
                    explanation: "The 3-4 second rule gives you enough time to react safely to sudden changes in traffic conditions.",
                    category: "safety"
                },
                {
                    question: "When should you use your headlights?",
                    answers: ["Only at night", "From sunset to sunrise", "30 minutes after sunset to 30 minutes before sunrise", "Anytime for better visibility"],
                    correct: 2,
                    explanation: "Washington law requires headlights from 30 minutes after sunset to 30 minutes before sunrise, plus during rain, fog, or low visibility.",
                    category: "safety"
                },
                {
                    question: "When should you switch from high beams to low beams?",
                    answers: ["500 feet before oncoming traffic", "300 feet when following another vehicle", "Both A and B", "Never switch"],
                    correct: 2,
                    explanation: "Switch to low beams when within 500 feet of oncoming traffic or within 300 feet when following another vehicle.",
                    category: "safety"
                },
                {
                    question: "What should you do if you start to skid?",
                    answers: ["Brake hard", "Steer in the opposite direction", "Take foot off accelerator and steer in direction of skid", "Turn the steering wheel rapidly"],
                    correct: 2,
                    explanation: "If skidding, take your foot off the accelerator and steer gently in the same direction your vehicle is moving to regain control.",
                    category: "safety"
                },
                {
                    question: "What is the most effective thing you can do to protect yourself in a crash?",
                    answers: ["Grip the steering wheel", "Brace for impact", "Wear your seatbelt correctly", "Close your eyes"],
                    correct: 2,
                    explanation: "Wearing your seatbelt correctly is the most effective way to protect yourself and dramatically reduces the risk of fatal injury.",
                    category: "safety"
                },
                {
                    question: "Where should children under 13 years old sit in a vehicle?",
                    answers: ["Front seat", "Back seat", "Either front or back", "Driver's lap"],
                    correct: 1,
                    explanation: "Children under 13 should always ride in the back seat because airbags can seriously injure or kill young children.",
                    category: "safety"
                },
                {
                    question: "What should you do when approaching emergency vehicles with flashing lights?",
                    answers: ["Speed up to get past", "Maintain current speed", "Move over or slow down by 10 mph", "Stop completely"],
                    correct: 2,
                    explanation: "Move over to a farther lane when possible, or slow down to at least 10 mph below the posted speed limit (never exceed 50 mph).",
                    category: "safety"
                },
                {
                    question: "What is hydroplaning?",
                    answers: ["Flying over water", "Tires losing contact with road due to water", "Sliding on ice", "Mechanical failure"],
                    correct: 1,
                    explanation: "Hydroplaning occurs when water builds up between tires and road surface, causing loss of traction. Slow down in wet conditions.",
                    category: "safety"
                }
            ],
            vehicles: [
                {
                    question: "What should you do before starting your vehicle?",
                    answers: ["Check your mirrors only", "Adjust seat, mirrors, and check surroundings", "Start immediately", "Only check the gas"],
                    correct: 1,
                    explanation: "Always adjust your seat, mirrors, and steering wheel, and check around your vehicle for obstacles before starting.",
                    category: "vehicles"
                },
                {
                    question: "What is the minimum tire tread depth allowed?",
                    answers: ["1/32 inch", "2/32 inch", "3/32 inch", "4/32 inch"],
                    correct: 1,
                    explanation: "Tire tread should not be less than 2/32 of an inch to maintain proper traction, especially in wet conditions.",
                    category: "vehicles"
                },
                {
                    question: "How should you position your hands on the steering wheel?",
                    answers: ["10 and 2 o'clock", "9 and 3 o'clock", "8 and 4 o'clock", "12 and 6 o'clock"],
                    correct: 1,
                    explanation: "The 9 and 3 o'clock position provides the best control and keeps your hands away from the airbag deployment area.",
                    category: "vehicles"
                },
                {
                    question: "What should your chest distance be from the steering wheel?",
                    answers: ["6 inches", "8 inches", "10 inches", "12 inches"],
                    correct: 2,
                    explanation: "Your chest should be at least 10 inches from the steering wheel to allow proper airbag deployment space.",
                    category: "vehicles"
                },
                {
                    question: "When should you check your mirrors?",
                    answers: ["Only when changing lanes", "Every 5-8 seconds", "When you remember", "Only when backing up"],
                    correct: 1,
                    explanation: "Check your mirrors frequently (every 5-8 seconds) to maintain awareness of your surroundings and traffic conditions.",
                    category: "vehicles"
                },
                {
                    question: "What should you do if your engine suddenly stops while driving?",
                    answers: ["Panic and stop immediately", "Keep strong grip on wheel, brake steadily, pull off road", "Try to restart while driving", "Turn off all lights"],
                    correct: 1,
                    explanation: "Maintain steering control (it will be harder), brake steadily, and pull off the roadway safely before attempting to restart.",
                    category: "vehicles"
                },
                {
                    question: "When should you replace windshield wipers?",
                    answers: ["Every year", "When they streak or don't clear properly", "Every oil change", "Never"],
                    correct: 1,
                    explanation: "Replace wipers when they leave streaks, make noise, or don't clear the windshield properly for optimal visibility.",
                    category: "vehicles"
                },
                {
                    question: "How often should you check your vehicle's lights?",
                    answers: ["Monthly", "Before every trip", "Annually", "When they burn out"],
                    correct: 1,
                    explanation: "You should regularly check that all lights are working properly - headlights, brake lights, turn signals, and hazard lights.",
                    category: "vehicles"
                }
            ],
            laws: [
                {
                    question: "What is the speed limit in a school zone in Washington?",
                    answers: ["15 mph", "20 mph", "25 mph", "30 mph"],
                    correct: 1,
                    explanation: "The speed limit in Washington school zones is 20 mph to protect children and other pedestrians.",
                    category: "laws"
                },
                {
                    question: "What is the legal BAC limit for drivers 21 and older in Washington?",
                    answers: ["0.05%", "0.08%", "0.10%", "0.12%"],
                    correct: 1,
                    explanation: "The legal blood alcohol concentration limit is 0.08% for drivers 21 and older. For drivers under 21, it's 0.02%.",
                    category: "laws"
                },
                {
                    question: "How long do new residents have to get a Washington driver license?",
                    answers: ["15 days", "30 days", "60 days", "90 days"],
                    correct: 1,
                    explanation: "New Washington residents have 30 days to obtain a Washington State driver license if they're licensed in another state.",
                    category: "laws"
                },
                {
                    question: "What happens if you refuse a breath test in Washington?",
                    answers: ["Nothing", "Small fine", "License suspension", "Immediate arrest"],
                    correct: 2,
                    explanation: "Refusing a breath test results in automatic license suspension for 90 to 730 days under Washington's Implied Consent Law.",
                    category: "laws"
                },
                {
                    question: "What are the passenger restrictions for intermediate license holders in the first 6 months?",
                    answers: ["No restrictions", "No passengers under 20 except family", "Only 1 passenger", "No passengers at all"],
                    correct: 1,
                    explanation: "For the first 6 months, intermediate license holders cannot have passengers under 20 except immediate family members.",
                    category: "laws"
                },
                {
                    question: "What are the nighttime driving restrictions for intermediate license holders?",
                    answers: ["No restrictions", "No driving between 1 a.m. and 5 a.m.", "No driving between 10 p.m. and 6 a.m.", "No driving after 8 p.m."],
                    correct: 1,
                    explanation: "Intermediate license holders cannot drive between 1 a.m. and 5 a.m. unless accompanied by a parent, guardian, or licensed driver 25+.",
                    category: "laws"
                },
                {
                    question: "Can you make a U-turn at an intersection with a traffic light?",
                    answers: ["Never", "Only if a sign permits it", "Yes, unless prohibited by signs", "Only during green lights"],
                    correct: 2,
                    explanation: "U-turns are generally allowed in Washington unless specifically prohibited by signs, but you must yield to all traffic and pedestrians.",
                    category: "laws"
                },
                {
                    question: "What is the legal THC limit for drivers 21 and older?",
                    answers: ["0 nanograms", "5 nanograms per milliliter", "10 nanograms per milliliter", "15 nanograms per milliliter"],
                    correct: 1,
                    explanation: "The legal limit is 5 nanograms of active THC per milliliter of blood for drivers 21+. For under 21, it's 0 nanograms.",
                    category: "laws"
                }
            ],
            technology: [
                {
                    question: "What does ABS stand for in vehicle safety?",
                    answers: ["Advanced Brake System", "Anti-lock Braking System", "Automatic Brake Support", "All-weather Brake Safety"],
                    correct: 1,
                    explanation: "ABS (Anti-lock Braking System) prevents wheels from locking up during hard braking, allowing you to maintain steering control.",
                    category: "technology"
                },
                {
                    question: "What should you do when ABS activates?",
                    answers: ["Pump the brakes", "Release the brakes", "Continue steady pressure on brake pedal", "Turn off the ABS"],
                    correct: 2,
                    explanation: "When ABS activates (you'll feel pulsing), maintain steady pressure on the brake pedal and continue steering around obstacles.",
                    category: "technology"
                },
                {
                    question: "Should you rely completely on vehicle safety technology?",
                    answers: ["Yes, it's completely reliable", "No, you must remain alert and engaged", "Only in good weather", "Only on highways"],
                    correct: 1,
                    explanation: "Vehicle safety technology assists but doesn't replace attentive driving. You must remain alert and ready to take control at any time.",
                    category: "technology"
                },
                {
                    question: "What does adaptive cruise control do?",
                    answers: ["Maintains set speed only", "Adjusts speed based on traffic ahead", "Automatically changes lanes", "Controls steering"],
                    correct: 1,
                    explanation: "Adaptive cruise control maintains your set speed but automatically adjusts it based on the distance to vehicles ahead.",
                    category: "technology"
                },
                {
                    question: "What can affect the performance of vehicle safety sensors?",
                    answers: ["Dirty sensors", "Weather conditions", "Faded road markings", "All of the above"],
                    correct: 3,
                    explanation: "Dirty sensors, severe weather, and faded road markings can all affect how well vehicle safety technology functions.",
                    category: "technology"
                },
                {
                    question: "What is lane departure warning designed to do?",
                    answers: ["Automatically steer back into lane", "Alert when drifting from lane", "Change lanes automatically", "Control vehicle speed"],
                    correct: 1,
                    explanation: "Lane departure warning alerts you when your vehicle begins to drift out of its lane without signaling, helping prevent unintended lane changes.",
                    category: "technology"
                },
                {
                    question: "What is the purpose of blind spot detection systems?",
                    answers: ["Replace mirrors", "Alert when vehicles are in blind spots", "Automatically change lanes", "Turn on turn signals"],
                    correct: 1,
                    explanation: "Blind spot detection alerts you when vehicles are in your blind spots, but you should still check mirrors and look over your shoulder.",
                    category: "technology"
                },
                {
                    question: "What is automatic emergency braking designed to do?",
                    answers: ["Replace your braking", "Assist in emergency stops", "Brake for normal stops", "Control vehicle in turns"],
                    correct: 1,
                    explanation: "Automatic emergency braking can detect obstacles and apply brakes to help avoid or reduce the severity of collisions, but you should still brake yourself.",
                    category: "technology"
                }
            ]
        };

        // Load stats from localStorage
        function loadStats() {
            const saved = localStorage.getItem('elianaDriverStats');
            if (saved) {
                stats = JSON.parse(saved);
                updateStatsDisplay();
            }
        }

        // Save stats to localStorage
        function saveStats() {
            localStorage.setItem('elianaDriverStats', JSON.stringify(stats));
        }

        // Update stats display
        function updateStatsDisplay() {
            document.getElementById('totalQuestions').textContent = stats.totalQuestions;
            document.getElementById('correctAnswers').textContent = stats.correctAnswers;
            document.getElementById('currentStreak').textContent = stats.currentStreak;
            document.getElementById('bestStreak').textContent = stats.bestStreak;
        }

        // Show main menu
        function showMainMenu() {
            // End session if one is active
            if (stats.currentSession) {
                endStudySession();
            }
            
            document.getElementById('mainMenu').style.display = 'grid';
            document.getElementById('categorySelector').style.display = 'none';
            document.getElementById('questionArea').style.display = 'none';
        }

        // Show category selector
        function showCategorySelector() {
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('categorySelector').style.display = 'block';
            document.getElementById('questionArea').style.display = 'none';
        }

        // Start practice mode
        function startPractice() {
            currentMode = 'practice';
            const allQuestions = Object.values(questionBank).flat();
            questions = shuffleArray([...allQuestions]).slice(0, 10);
            startQuiz();
        }

        // Start category practice
        function startCategoryPractice(category) {
            currentMode = 'category';
            questions = shuffleArray([...questionBank[category]]);
            startQuiz();
        }

        // Start mock test
        function startMockTest() {
            currentMode = 'mock';
            const allQuestions = Object.values(questionBank).flat();
            questions = shuffleArray([...allQuestions]).slice(0, 25);
            startQuiz();
        }

        // Start quiz
        function startQuiz() {
            currentQuestion = 0;
            trackStudySession(); // Start tracking this session
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('categorySelector').style.display = 'none';
            document.getElementById('questionArea').style.display = 'block';
            showQuestion();
        }

        // Show current question
        function showQuestion() {
            const q = questions[currentQuestion];
            document.getElementById('questionText').textContent = q.question;
            document.getElementById('questionCounter').textContent = `${currentQuestion + 1} / ${questions.length}`;
            
            const progress = ((currentQuestion) / questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';

            const answersContainer = document.getElementById('answersContainer');
            answersContainer.innerHTML = '';
            
            q.answers.forEach((answer, index) => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.textContent = `${String.fromCharCode(65 + index)}. ${answer}`;
                btn.onclick = () => selectAnswer(index);
                answersContainer.appendChild(btn);
            });

            document.getElementById('explanation').style.display = 'none';
            document.getElementById('nextBtn').disabled = true;
        }

        // Select answer
        function selectAnswer(selectedIndex) {
            const q = questions[currentQuestion];
            const buttons = document.querySelectorAll('.answer-btn');
            
            buttons.forEach((btn, index) => {
                btn.disabled = true;
                if (index === q.correct) {
                    btn.classList.add('correct');
                } else if (index === selectedIndex && index !== q.correct) {
                    btn.classList.add('incorrect');
                }
            });

            // Update stats
            stats.totalQuestions++;
            if (stats.currentSession) {
                stats.currentSession.questionsAnswered++;
            }
            
            if (selectedIndex === q.correct) {
                stats.correctAnswers++;
                stats.currentStreak++;
                if (stats.currentStreak > stats.bestStreak) {
                    stats.bestStreak = stats.currentStreak;
                }
                if (stats.currentSession) {
                    stats.currentSession.correctAnswers++;
                }
                showReward(true);
            } else {
                stats.currentStreak = 0;
                showReward(false);
            }

            saveStats();
            updateStatsDisplay();

            // Show explanation
            document.getElementById('explanation').innerHTML = `
                <strong>${selectedIndex === q.correct ? '‚úÖ Correct!' : '‚ùå Incorrect'}</strong><br>
                ${q.explanation}
            `;
            document.getElementById('explanation').style.display = 'block';
            document.getElementById('nextBtn').disabled = false;
        }

        // Show reward
        function showReward(isCorrect) {
            const modal = document.getElementById('rewardModal');
            const image = document.getElementById('rewardImage');
            const title = document.getElementById('rewardTitle');
            const message = document.getElementById('rewardMessage');
            const celebration = document.getElementById('celebrationText');

            if (isCorrect) {
                const imageNum = Math.floor(Math.random() * 78) + 1;
                image.src = `https://github.com/d6ewasupervisor-netizen/WA-DOL/raw/main/yes/Yes_${imageNum}.jpg`;
                title.textContent = "Awesome! üéâ";
                message.textContent = "You're doing great, Eliana! Keep up the fantastic work!";
                celebration.textContent = "üéâ‚ú®üíï";
            } else {
                const imageNum = Math.floor(Math.random() * 47) + 1;
                image.src = `https://github.com/d6ewasupervisor-netizen/WA-DOL/raw/main/no/No_${imageNum}.jpg`;
                title.textContent = "Keep Learning! üí™";
                message.textContent = "That's okay! Every mistake is a step closer to mastering driving!";
                celebration.textContent = "üåüüìöüíï";
            }

            modal.style.display = 'flex';
        }

        // Close reward modal
        function closeReward() {
            document.getElementById('rewardModal').style.display = 'none';
        }

        // Next question
        function nextQuestion() {
            currentQuestion++;
            if (currentQuestion < questions.length) {
                showQuestion();
            } else {
                showResults();
            }
        }

        // Show results
        function showResults() {
            endStudySession(); // End the tracking session
            
            const correct = questions.reduce((count, q, index) => {
                return count + (document.querySelectorAll('.answer-btn.correct')[index] ? 1 : 0);
            }, 0);
            
            alert(`Quiz Complete! üéâ\n\nYou got ${stats.correctAnswers} out of ${stats.totalQuestions} questions right!\n\nAccuracy: ${Math.round((stats.correctAnswers / stats.totalQuestions) * 100)}%\n\nKeep practicing, Eliana! You're doing amazing! üíï`);
            showMainMenu();
        }

        // Show stats
        function showStats() {
            const accuracy = stats.totalQuestions > 0 ? Math.round((stats.correctAnswers / stats.totalQuestions) * 100) : 0;
            alert(`üìä Eliana's Progress Report üìä\n\n` +
                  `Total Questions: ${stats.totalQuestions}\n` +
                  `Correct Answers: ${stats.correctAnswers}\n` +
                  `Accuracy: ${accuracy}%\n` +
                  `Best Streak: ${stats.bestStreak}\n` +
                  `Current Streak: ${stats.currentStreak}\n\n` +
                  `You're making great progress! üåüüíï`);
        }

        // Utility function to shuffle array
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Initialize app
        window.onload = function() {
            loadStats();
        };
    </script>
</body>
</html>
